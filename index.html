<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Douyin ÊäñÈü≥ | Estudio Etno-Ecol√≥gico de Nichos 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 30px 20px; border-bottom: 1px solid #333; margin-bottom: 30px; }
        header h1 { font-size: 1.8rem; margin-bottom: 10px; color: #00ffcc; }
        header p { color: #888; font-size: 0.95rem; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 25px 0; }
        .stat-card { background: #1a1a1a; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #333; }
        .stat-card .number { font-size: 1.8rem; font-weight: bold; color: #00ffcc; }
        .stat-card .label { font-size: 0.85rem; color: #888; margin-top: 5px; }
        .nav { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px; justify-content: center; }
        .nav-item { padding: 10px 20px; background: #1a1a1a; border: 1px solid #333; border-radius: 25px; cursor: pointer; transition: all 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .nav-item.active { background: #00ffcc; color: #000; border-color: #00ffcc; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .galeria { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .card { background: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s; border: 1px solid #333; }
        .card:hover { transform: translateY(-5px); border-color: #00ffcc; }
        .card-img { width: 100%; height: 220px; object-fit: cover; display: block; }
        .tabla-container { overflow-x: auto; background: #1a1a1a; border-radius: 10px; padding: 15px; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #333; font-size: 0.9rem; }
        th { color: #00ffcc; font-weight: 600; position: sticky; top: 0; background: #1a1a1a; }
        tr:hover { background: #252525; }
        #chinaMap { width: 100%; height: 600px; background: #1a1a1a; border-radius: 10px; border: 1px solid #333; }
        #barChart { width: 100%; height: 500px; background: #1a1a1a; border-radius: 10px; border: 1px solid #333; margin-top: 20px; }
        .metodo { background: #1a1a1a; padding: 25px; border-radius: 10px; border: 1px solid #333; line-height: 1.8; }
        .metodo h3 { color: #00ffcc; margin-bottom: 15px; }
        .metodo ul { margin-left: 20px; margin-bottom: 15px; }
        footer { text-align: center; padding: 30px 20px; margin-top: 40px; border-top: 1px solid #333; color: #888; font-size: 0.9rem; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        #modal.active { display: flex; }
        #modal-img { max-width: 90%; max-height: 90%; border-radius: 10px; border: 2px solid #00ffcc; }
        .modal-close { position: absolute; top: 20px; right: 30px; font-size: 2rem; color: #fff; cursor: pointer; }
        .modal-close:hover { color: #00ffcc; }
        @media (max-width: 768px) {
            .galeria { grid-template-columns: repeat(2, 1fr); }
            .card-img { height: 180px; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .nav { flex-wrap: wrap; }
            .nav-item { padding: 8px 15px; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Douyin ÊäñÈü≥</h1>
            <p>ESTUDIO ETNO-ECOL√ìGICO DE NICHOS EN DOUYIN 2026</p>
            <p style="color:#666;margin-top:5px">Juan Carlos Delgado</p>
        </header><!-- PANEL TOP 3 TEM√ÅTICAS -->
<div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:2rem;border-radius:15px;color:white;margin:2rem auto;max-width:800px;box-shadow:0 10px 30px rgba(0,0,0,0.3);">
  <h3 style="margin:0 0 1.5rem 0;font-size:1.5rem;text-align:center">üèÜ TOP 3 Tem√°ticas - Influencers Famosas</h3>
  <div id="top3-tematicas"></div>
  <small style="display:block;text-align:center;margin-top:1rem;opacity:0.8">* Famosas = +1M seguidores en Douyin</small>
</div>
<script>
function calcularTop3Tematicas(){const cards=window.fichas||[];const famosas=cards.filter(c=>(c.seguidores||0)>=1);const conteo={};famosas.forEach(c=>{const t=c.tematica_principal||'otras';if(!conteo[t])conteo[t]={count:0};conteo[t].count++;});const total=famosas.length;if(total===0){document.getElementById('top3-tematicas').innerHTML='<p style="text-align:center;padding:2rem">üìä Sin datos suficientes</p>';return;}const top3=Object.entries(conteo).map(([t,d])=>({tematica:t,count:d.count,porcentaje:Math.round((d.count/total)*100)})).sort((a,b)=>b.porcentaje-a.porcentaje).slice(0,3);const emojis={danza:'üíÉ',tradicional:'üé≠',lifestyle:'üëó',deportes:'üèÉ',musica:'üéµ',arte:'üé®',otras:'‚≠ê'};const medallas=['ü•á','ü•à','ü•â'];let html='';top3.forEach((item,i)=>{const emoji=emojis[item.tematica]||'‚≠ê';html+='<div style="display:flex;align-items:center;margin:1rem 0;padding:1rem;background:rgba(255,255,255,0.15);border-radius:10px;"><div style="font-size:2.5rem;margin-right:1rem;width:50px;text-align:center">'+medallas[i]+'</div><div style="flex:1"><div style="font-size:1.2rem;font-weight:bold;margin-bottom:0.3rem">'+emoji+' '+item.tematica.charAt(0).toUpperCase()+item.tematica.slice(1)+'</div><div style="font-size:0.9rem;opacity:0.9">'+item.count+' de '+total+' influencers famosas</div></div><div style="font-size:2.5rem;font-weight:bold;color:#FFD700">'+item.porcentaje+'%</div></div>';});document.getElementById('top3-tematicas').innerHTML=html;}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',calcularTop3Tematicas);}else{calcularTop3Tematicas();}
setInterval(calcularTop3Tematicas,30000);
</script>

        <div class="stats">
            <div class="stat-card"><div class="number" id="total-fichas">0</div><div class="label">Creadoras</div></div>
            <div class="stat-card"><div class="number" id="max-seguidores">0</div><div class="label">M√°x seguidores</div></div>
            <div class="stat-card"><div class="number" id="max-ratio">0</div><div class="label">M√°x ratio</div></div>
            <div class="stat-card"><div class="number" id="total-regiones">0</div><div class="label">Regiones</div></div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="showSection('lista')">üìã LISTA</div>
            <div class="nav-item" onclick="showSection('galeria')">üñºÔ∏è GALER√çA</div>
            <div class="nav-item" onclick="showSection('ranking')">üìä RANKING</div>
            <div class="nav-item" onclick="showSection('mapa')">üó∫Ô∏è MAPA</div>
            <div class="nav-item" onclick="showSection('metodo')">üìö M√âTODO</div>
        </div>

        <section id="lista" class="section active">
            <h2 style="margin-bottom:15px;color:#00ffcc">üìã LISTA MAESTRA</h2>
            <p style="color:#888;margin-bottom:20px">"Cada creadora es un dato en el ecosistema Douyin"</p>
            <div class="tabla-container">
                <table>
                    <thead><tr><th>Nombre</th><th>Seguidores</th><th>Likes</th><th>Ratio</th><th>Origen</th><th>Nicho</th></tr></thead>
                    <tbody id="tabla-body"></tbody>
                </table>
            </div>
        </section>

        <section id="galeria" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">üñºÔ∏è GALER√çA</h2>
            <div id="galeria-cards" class="galeria"></div>
        </section>

        <section id="ranking" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">üìä RANKING</h2>
            <div id="barChart"></div>
        </section>

        <section id="mapa" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">üó∫Ô∏è MAPA DE CHINA</h2>
            <div id="chinaMap"></div>
        </section>

        <section id="metodo" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">üìö M√âTODO ETNO-ECOL√ìGICO</h2>
            <div class="metodo">
                <h3>üîç Enfoque</h3>
                <ul>
                    <li>Observaci√≥n participante en Douyin (2024-2026)</li>
                    <li>Mapeo de nichos por regi√≥n, contenido y engagement</li>
                    <li>An√°lisis cualitativo + m√©tricas cuantitativas</li>
                </ul>
                <h3>üìä M√©tricas clave</h3>
                <ul>
                    <li><strong>Ratio:</strong> Likes √∑ Seguidores (engagement relativo)</li>
                    <li><strong>Origen:</strong> Provincia/ciudad de la creadora</li>
                    <li><strong>Nicho:</strong> Categor√≠a principal de contenido</li>
                </ul>
                <h3>üåê Visualizaci√≥n</h3>
                <ul>
                    <li>Mapa interactivo con ECharts</li>
                    <li>Ranking de engagement por creadora</li>
                    <li>Galer√≠a visual con filtros por nicho</li>
                </ul>
                <p style="margin-top:20px;color:#888;font-size:0.9rem">
                    <strong>Nota:</strong> Este estudio documenta tendencias emergentes en Douyin. 
                    Los datos son p√∫blicos y se actualizan mensualmente.
                </p>
            </div>
        </section>

        <footer>
            <p>Estudio Etno-Ecol√≥gico de Nichos en Douyin 2026</p>
            <p style="margin-top:10px">Juan Carlos Delgado ¬∑ Marzo 2026</p>
            <p id="footer-fichas" style="margin-top:10px;color:#666">0 creadoras ¬∑ 30,500+ comunidad</p>
            <p style="margin-top:20px;font-size:0.85rem;color:#666">
                üì± <strong>VERSI√ìN M√ìVIL:</strong> Optimizada para computadora. 
                En m√≥vil, la galer√≠a se ve en 2 columnas, el mapa puede no cargar.
            </p>
            <p style="margin-top:10px;font-size:0.85rem;color:#444">visitas</p>
        </footer>
    </div>

    <!-- Modal para im√°genes -->
    <div id="modal" onclick="cerrarModal()">
        <span class="modal-close">&times;</span>
        <img id="modal-img" src="" alt="Vista ampliada">
    </div>

    <!-- Scripts: PRIMERO fichas.js (datos), DESPU√âS el resto -->
    <script src="fichas.js"></script>
    <script>
        let cardsVisibles = 12;
        const cardsPorCarga = 12;

        function actualizarPagina() {
            if (!fichas || fichas.length === 0) return;
            const porSeguidores = [...fichas].sort((a, b) => b.seguidores - a.seguidores);
            
            if (document.getElementById('total-fichas')) document.getElementById('total-fichas').textContent = fichas.length;
            if (document.getElementById('max-seguidores')) document.getElementById('max-seguidores').textContent = porSeguidores[0].seguidores.toFixed(2) + 'M';
            if (document.getElementById('max-ratio')) document.getElementById('max-ratio').textContent = Math.max(...fichas.map(f => f.ratio)).toFixed(2);
            const regiones = new Set(fichas.map(f => f.origen.split(',')[0].trim()));
            if (document.getElementById('total-regiones')) document.getElementById('total-regiones').textContent = regiones.size;
            if (document.getElementById('footer-fichas')) document.getElementById('footer-fichas').textContent = fichas.length + ' creadoras ¬∑ 30,500+ comunidad';
            
            const tbody = document.getElementById('tabla-body');
            if (tbody) {
                tbody.innerHTML = '';
                porSeguidores.forEach(f => {
                    tbody.innerHTML += '<tr><td>' + f.nombre + ' (' + f.pinyin + ')</td><td>' + f.seguidores.toFixed(3) + 'M</td><td>' + f.likes + 'M</td><td>' + f.ratio.toFixed(2) + '</td><td>' + f.origen + '</td><td>' + f.nicho + '</td></tr>';
                });
            }
            
            const galeria = document.getElementById('galeria-cards');
            if (galeria) {
                galeria.innerHTML = '';
                fichas.slice(0, cardsVisibles).forEach(f => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.onclick = (e) => { e.stopPropagation(); abrirModal(f.archivo); };
                    card.innerHTML = '<img src="https://raw.githubusercontent.com/dicarlophotoart-blip/estudio-douyin-2026/main/cards/' + encodeURIComponent(f.archivo) + '" class="card-img" loading="lazy">';
                    galeria.appendChild(card);
                });
                if (cardsVisibles < fichas.length) {
                    const btnMas = document.createElement('div');
                    btnMas.style.cssText = 'grid-column: 1/-1; text-align: center; margin: 30px 0;';
                    btnMas.innerHTML = '<button class="nav-item" onclick="cargarMasCards()" style="padding:12px 30px;font-size:16px;cursor:pointer;">üì∑ Ver m√°s creadoras (' + (fichas.length - cardsVisibles) + ' restantes)</button>';
                    galeria.appendChild(btnMas);
                }
            }
        }

        function cargarMasCards() {
            cardsVisibles += cardsPorCarga;
            actualizarPagina();
            const galeria = document.getElementById('galeria');
            if (galeria) galeria.scrollIntoView({ behavior: 'smooth' });
        }

        function generarMapa() {
            const mapDiv = document.getElementById('chinaMap');
            if (!mapDiv) return;
            let chart = echarts.getInstanceByDom(mapDiv);
            if (chart) echarts.dispose(chart);
            chart = echarts.init(mapDiv);
            
            const fichasConCoordenadas = fichas.filter(f => f.coord && Array.isArray(f.coord) && f.coord.length === 2);
            const grupos = {};
            fichasConCoordenadas.forEach(f => {
                const key = f.coord[0] + ',' + f.coord[1];
                if (!grupos[key]) grupos[key] = { coord: f.coord, creadoras: [], total: 0 };
                grupos[key].creadoras.push(f);
                grupos[key].total += f.seguidores;
            });
            
            const puntosData = Object.values(grupos).map(g => ({
                name: g.creadoras.length > 1 ? g.creadoras.length + ' creadoras' : g.creadoras[0].nombre,
                value: [...g.coord, g.creadoras.length],
                cantidad: g.creadoras.length,
                creadoras: g.creadoras.map(c => ({ nombre: c.nombre, pinyin: c.pinyin, origen: c.origen, nicho: c.nicho, seguidores: c.seguidores, ratio: c.ratio })),
                totalSeguidores: g.total
            }));
            
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Distribuci√≥n de ' + fichasConCoordenadas.length + ' creadoras', left: 'center', textStyle: { color: '#00ffcc', fontSize: 16 } },
                tooltip: { 
                    trigger: 'item', 
                    formatter: (p) => { 
                        const d = p.data; 
                        if (!d || !d.creadoras) return ''; 
                        let h = '<b>' + d.cantidad + ' creadora' + (d.cantidad > 1 ? 's' : '') + '</b><br/>üìç Total: ' + d.totalSeguidores.toFixed(3) + 'M<br/><br/>'; 
                        d.creadoras.forEach((c, i) => { 
                            h += (i+1) + '. <b>' + c.nombre + '</b> (' + c.pinyin + ')<br/>   üìç ' + c.origen + '<br/>   üé® ' + c.nicho + '<br/>   üë• ' + c.seguidores.toFixed(3) + 'M ¬∑ üìà ' + c.ratio.toFixed(2) + '<br/><br/>'; 
                        }); 
                        return h.slice(0, -4); 
                    } 
                },
                geo: { 
                    map: 'china', roam: true, zoom: 1.2, 
                    label: { show: true, color: '#fff', fontSize: 9 }, 
                    itemStyle: { areaColor: '#1a1a1a', borderColor: '#00ffcc', borderWidth: 1 }, 
                    emphasis: { itemStyle: { areaColor: '#2a2a2a' } } 
                },
                series: [{ 
                    name: 'Puntos', type: 'scatter', coordinateSystem: 'geo', data: puntosData, 
                    symbol: 'circle', symbolSize: v => Math.max(12, Math.min(60, v[2]*10 + Math.sqrt(v[2])*5)), 
                    label: { show: true, formatter: p => p.data.cantidad > 1 ? p.data.cantidad : '', position: 'inside', color: '#000', fontSize: 12, fontWeight: 'bold' }, 
                    itemStyle: { color: p => p.data.cantidad > 1 ? '#ffaa00' : '#00ffcc', borderColor: '#fff', borderWidth: 2, shadowBlur: 10 }, 
                    emphasis: { itemStyle: { color: p => p.data.cantidad > 1 ? '#ffcc00' : '#00ffff', borderWidth: 4 } } 
                }]
            };
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        function generarRanking() {
            const chartDiv = document.getElementById('barChart');
            if (!chartDiv) return;
            let chart = echarts.getInstanceByDom(chartDiv);
            if (chart) echarts.dispose(chart);
            chart = echarts.init(chartDiv);
            
            const top10 = [...fichas].sort((a, b) => b.ratio - a.ratio).slice(0, 10);
            const nombres = top10.map(f => f.nombre + '\n' + f.pinyin);
            const likesData = top10.map(f => f.likes);
            const seguidoresData = top10.map(f => f.seguidores);
            
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Top 10: Likes vs Seguidores', subtext: 'Cyan = Likes | Naranja = Seguidores', left: 'center', textStyle: { color: '#00ffcc', fontSize: 16 }, subtextStyle: { color: '#888', fontSize: 11 } },
                tooltip: { 
                    trigger: 'axis', axisPointer: { type: 'shadow' }, 
                    formatter: p => { 
                        const f = top10[p[0].dataIndex]; 
                        return '<b>' + f.nombre + '</b> (' + f.pinyin + ')<br/>üìç ' + f.origen + '<br/>‚ù§Ô∏è Likes: <b style="color:#00ffcc">' + f.likes + 'M</b><br/>üë• Seguidores: <b style="color:#ffaa00">' + f.seguidores.toFixed(2) + 'M</b><br/>üìà Ratio: <b style="color:#00ffcc">' + f.ratio.toFixed(2) + '</b>'; 
                    } 
                },
                legend: { data: ['Likes (M)', 'Seguidores (M)'], textStyle: { color: '#fff' }, top: 40 },
                grid: { left: '3%', right: '4%', bottom: '3%', top: '15%', containLabel: true },
                xAxis: { type: 'value', name: 'Millones', axisLine: { lineStyle: { color: '#00ffcc' } }, axisLabel: { color: '#888' }, splitLine: { lineStyle: { color: '#333', type: 'dashed' } } },
                yAxis: { type: 'category', data: nombres, axisLabel: { color: '#fff', fontSize: 11, margin: 15 } },
                series: [
                    { name: 'Likes (M)', type: 'bar', data: likesData, itemStyle: { color: '#00ffcc', borderRadius: [0, 3, 3, 0] }, label: { show: true, position: 'right', color: '#00ffcc', fontSize: 10, formatter: p => p.value + 'M' } },
                    { name: 'Seguidores (M)', type: 'bar', data: seguidoresData, itemStyle: { color: '#ffaa00', borderRadius: [0, 3, 3, 0] }, label: { show: true, position: 'right', color: '#ffaa00', fontSize: 10, formatter: p => p.value.toFixed(2) + 'M' } }
                ]
            };
            chart.setOption(option);
            setTimeout(() => chart.resize(), 100);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            if (sectionId === 'mapa') { setTimeout(() => { if (typeof echarts !== 'undefined' && typeof generarMapa === 'function') generarMapa(); }, 200); }
            if (sectionId === 'ranking') { setTimeout(() => { if (typeof echarts !== 'undefined' && typeof generarRanking === 'function') generarRanking(); }, 200); }
            if (sectionId === 'galeria') { setTimeout(() => { if (typeof actualizarPagina === 'function') actualizarPagina(); }, 200); }
        }

        function abrirModal(archivo) {
            const img = document.getElementById('modal-img');
            const modal = document.getElementById('modal');
            if (img && modal) {
                img.src = 'https://raw.githubusercontent.com/dicarlophotoart-blip/estudio-douyin-2026/main/cards/' + encodeURIComponent(archivo);
                modal.style.display = 'block';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function cerrarModal() {
            const modal = document.getElementById('modal');
            if (modal) { 
                modal.style.display = 'none'; 
                modal.classList.remove('active');
                document.body.style.overflow = 'auto'; 
            }
        }

        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') cerrarModal(); });
        document.getElementById('modal')?.addEventListener('click', function(e) { if (e.target === this) cerrarModal(); });

        // ‚úÖ INICIO DE LA APP: Cargar todo al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando aplicaci√≥n...');
            console.log('üìä ECharts cargado:', typeof echarts !== 'undefined');
            
            // ‚úÖ ACTUALIZAR P√ÅGINA CON LOS DATOS (esto faltaba)
            if (typeof fichas !== 'undefined' && typeof actualizarPagina === 'function') {
                actualizarPagina();
                console.log('‚úÖ P√°gina actualizada con', fichas.length, 'creadoras');
            } else {
                console.error('‚ùå fichas.js no carg√≥ o actualizarPagina no existe');
            }
            
            // Cargar mapa si est√° disponible
            if (typeof echarts !== 'undefined') {
                fetch('china.json')
                    .then(response => { if (!response.ok) throw new Error('HTTP ' + response.status); return response.json(); })
                    .then(chinaJson => {
                        echarts.registerMap('china', chinaJson);
                        console.log('‚úÖ Mapa registrado - Features:', chinaJson.features?.length);
                        if (document.getElementById('mapa')?.classList.contains('active')) {
                            setTimeout(() => { if (typeof generarMapa === 'function') generarMapa(); }, 300);
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Error cargando china.json:', error);
                        const mapDiv = document.getElementById('chinaMap');
                        if (mapDiv) {
                            mapDiv.innerHTML = '<div style="text-align:center;padding:80px 20px;color:#ffaa00;"><h3>‚ö†Ô∏è Error cargando mapa</h3><p>' + error.message + '</p><p style="margin-top:20px;font-size:12px;">Verifica que china.json est√° en la ra√≠z del repo</p></div>';
                        }
                    });
            } else {
                console.error('‚ùå ECharts no est√° disponible. El mapa y ranking no funcionar√°n.');
            }
        });
    </script>
</body>
</html>
