<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Douyin ÊäñÈü≥ | Estudio Etno-Ecol√≥gico de Nichos 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 30px 20px; border-bottom: 1px solid #333; margin-bottom: 30px; }
        header h1 { font-size: 1.8rem; margin-bottom: 10px; color: #00ffcc; }
        header p { color: #888; font-size: 0.95rem; }
        
        .top3-panel { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 20px; border-radius: 10px; margin: 25px 0; border: 2px solid #00ffcc; }
        .top3-panel h3 { text-align: center; color: #00ffcc; margin-bottom: 15px; font-size: 1.2rem; font-weight: 600; }
        .top3-item { display: flex; align-items: center; padding: 10px 15px; margin: 8px 0; background: rgba(0,255,204,0.05); border-radius: 8px; border-left: 3px solid #00ffcc; }
        .medal { font-size: 1.3rem; margin-right: 12px; width: 35px; text-align: center; font-weight: bold; color: #ffaa00; }
        .top3-info { flex: 1; }
        .top3-name { font-weight: 600; color: #fff; font-size: 1rem; }
        .top3-desc { font-size: 0.8rem; color: #888; margin-top: 2px; }
        .percentage { font-size: 1.3rem; font-weight: bold; color: #ffaa00; }
        .top3-note { text-align: center; font-size: 0.75rem; color: #666; margin-top: 12px; font-style: italic; }
        
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 25px 0; }
        .stat-card { background: #1a1a1a; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #333; }
        .stat-card .number { font-size: 1.8rem; font-weight: bold; color: #00ffcc; }
        .stat-card .label { font-size: 0.85rem; color: #888; margin-top: 5px; }
        .nav { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px; justify-content: center; }
        .nav-item { padding: 10px 20px; background: #1a1a1a; border: 1px solid #333; border-radius: 25px; cursor: pointer; transition: all 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .nav-item.active { background: #00ffcc; color: #000; border-color: #00ffcc; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .galeria { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .card { background: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s; border: 1px solid #333; }
        .card:hover { transform: translateY(-5px); border-color: #00ffcc; }
        .card-img { width: 100%; height: 220px; object-fit: cover; display: block; }
        .tabla-container { overflow-x: auto; background: #1a1a1a; border-radius: 10px; padding: 15px; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #333; font-size: 0.9rem; }
        th { color: #00ffcc; font-weight: 600; position: sticky; top: 0; background: #1a1a1a; }
        tr:hover { background: #252525; }
        #chinaMap { width: 100%; height: 600px; background: #1a1a1a; border-radius: 10px; border: 1px solid #333; }
        #barChart { width: 100%; height: 500px; background: #1a1a1a; border-radius: 10px; border: 1px solid #333; margin-top: 20px; }
        .metodo { background: #1a1a1a; padding: 25px; border-radius: 10px; border: 1px solid #333; line-height: 1.8; }
        .metodo h3 { color: #00ffcc; margin-bottom: 15px; }
        .metodo ul { margin-left: 20px; margin-bottom: 15px; }
        footer { text-align: center; padding: 30px 20px; margin-top: 40px; border-top: 1px solid #333; color: #888; font-size: 0.9rem; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        #modal.active { display: flex; }
        #modal-img { max-width: 90%; max-height: 90%; border-radius: 10px; border: 2px solid #00ffcc; }
        .modal-close { position: absolute; top: 20px; right: 30px; font-size: 2rem; color: #fff; cursor: pointer; }
        .modal-close:hover { color: #00ffcc; }
        @media (max-width: 768px) { .galeria { grid-template-columns: repeat(2, 1fr); } .card-img { height: 180px; } .stats { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Douyin ÊäñÈü≥</h1>
            <p>ESTUDIO ETNO-ECOL√ìGICO DE NICHOS EN DOUYIN 2026</p>
            <p style="color:#666;margin-top:5px">Juan Carlos Delgado</p>
        </header>

        <!-- ‚úÖ PANEL TOP 3 -->
        <div class="top3-panel">
            <h3>TOP 3 TEM√ÅTICAS - CREADORAS DESTACADAS</h3>
            <div id="top3-tematicas"><p style="text-align:center;color:#888">Cargando datos...</p></div>
            
            <div style="margin-top:15px;padding:12px;background:rgba(0,255,204,0.03);border-radius:6px;border-left:2px solid #00ffcc;font-size:0.72rem;color:#aaa;line-height:1.4;">
                <strong style="color:#00ffcc">Marco anal√≠tico (escala china Douyin):</strong><br>
                ‚Ä¢ üåü Mega: ‚â•10M | üî∑ Macro: 5-10M | üîπ Mid-tier: 1-5M | üî∏ Micro: <1M<br>
                ‚Ä¢ <em style="color:#aaa">Este estudio aplica esta escala para clasificar y comparar creadoras</em><br><br>
                <strong style="color:#ffaa00">Composici√≥n de la muestra actual:</strong><br>
                <div id="composicion-muestra">‚Ä¢ Cargando composici√≥n...</div>
                <br>
                <strong style="color:#ffaa00">Hallazgo:</strong><br>
                Engagement 15-31 en creadoras con Belleza ‚â•3 + Destreza ‚â•3 sugiere conexi√≥n intensa por combinaci√≥n est√©tica-performativa.<br>
                <em style="color:#888">Nota: M√©tricas sin ajuste temporal (dato no disponible en Douyin)</em>
            </div>
            <p class="top3-note" style="margin-top:10px">* Muestra preliminar: Sujetos a ampliaci√≥n</p>
        </div>

        <!-- ‚úÖ C√ÅLCULO AUTOM√ÅTICO DE PREFERENCIAS TEM√ÅTICAS -->
        <div style="margin-top:25px;padding:20px;background:linear-gradient(135deg, rgba(0,255,204,0.05) 0%, rgba(255,170,0,0.05) 100%);border-radius:10px;border:2px solid #00ffcc;">
            <h3 style="color:#00ffcc;margin-bottom:15px;text-align:center;">üìä Preferencias Tem√°ticas en Douyin</h3>
            <p style="text-align:center;color:#888;font-size:0.85rem;margin-bottom:15px;">C√°lculo autom√°tico basado en muestra actual</p>
            <div id="gustos-chinos-container"><p style="text-align:center;color:#666">Cargando datos...</p></div>
        </div>

        <!-- ‚úÖ CONTEXTO MACRO: Douyin en China -->
        <div style="margin-top:25px;padding:20px;background:linear-gradient(135deg, rgba(100,100,255,0.05) 0%, rgba(0,255,204,0.05) 100%);border-radius:10px;border:2px solid #6464ff;">
            <h3 style="color:#6464ff;margin-bottom:15px;text-align:center;">üåè Douyin en el Ecosistema Digital Chino</h3>
            <p style="text-align:center;color:#888;font-size:0.85rem;margin-bottom:15px;">Datos de mercado 2024-2026</p>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;">
                <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;text-align:center;border-top:3px solid #00ffcc;">
                    <div style="font-size:1.8rem;font-weight:bold;color:#00ffcc;">766.5M</div>
                    <div style="font-size:0.8rem;color:#aaa;margin-top:5px;">Usuarios mensuales</div>
                    <div style="font-size:0.7rem;color:#666;margin-top:3px;">#1 Mobile App China</div>
                </div>
                <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;text-align:center;border-top:3px solid #ffaa00;">
                    <div style="font-size:1.8rem;font-weight:bold;color:#ffaa00;">83%</div>
                    <div style="font-size:0.8rem;color:#aaa;margin-top:5px;">Penetraci√≥n internet</div>
                    <div style="font-size:0.7rem;color:#666;margin-top:3px;">#2 Social Media Usage</div>
                </div>
                <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;text-align:center;border-top:3px solid #00ffcc;">
                    <div style="font-size:1.8rem;font-weight:bold;color:#00ffcc;">29.3%</div>
                    <div style="font-size:0.8rem;color:#aaa;margin-top:5px;">Preferencia voluntaria</div>
                    <div style="font-size:0.7rem;color:#666;margin-top:3px;">#2 Favourite Platform</div>
                </div>
                <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;text-align:center;border-top:3px solid #ffaa00;">
                    <div style="font-size:1.8rem;font-weight:bold;color:#ffaa00;">#1</div>
                    <div style="font-size:0.8rem;color:#aaa;margin-top:5px;">Gasto del consumidor</div>
                    <div style="font-size:0.7rem;color:#666;margin-top:3px;">Highest in China</div>
                </div>
            </div>
            <p style="font-size:0.8rem;color:#aaa;line-height:1.6;margin-top:15px;text-align:center;">
                <strong style="color:#6464ff">Implicaci√≥n para este estudio:</strong><br>
                Los patrones identificados en nuestra muestra de 22 creadoras operan dentro 
                del ecosistema digital m√°s grande de China, con impacto econ√≥mico real y 
                preferencia voluntaria de casi 1 de cada 3 usuarios de redes sociales.
            </p>
        </div>

        <div class="stats">
            <div class="stat-card"><div class="number" id="total-fichas">0</div><div class="label">Creadoras</div></div>
            <div class="stat-card"><div class="number" id="max-seguidores">0</div><div class="label">M√°x seguidores</div></div>
            <div class="stat-card"><div class="number" id="max-ratio">0</div><div class="label">M√°x ratio</div></div>
            <div class="stat-card"><div class="number" id="total-regiones">0</div><div class="label">Regiones</div></div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="showSection('lista')">LISTA</div>
            <div class="nav-item" onclick="showSection('galeria')">GALER√çA</div>
            <div class="nav-item" onclick="showSection('ranking')">RANKING</div>
            <div class="nav-item" onclick="showSection('mapa')">MAPA</div>
            <div class="nav-item" onclick="showSection('metodo')">M√âTODO</div>
            <div class="nav-item" onclick="showSection('temporal')">TEMPORAL</div>
        </div>

        <section id="lista" class="section active">
            <h2 style="margin-bottom:15px;color:#00ffcc">LISTA MAESTRA</h2>
            <p style="color:#888;margin-bottom:20px">"Cada creadora es un dato en el ecosistema Douyin"</p>
            <div class="tabla-container">
                <table>
                    <thead><tr><th>Nombre</th><th>Seguidores</th><th>Likes</th><th>Ratio</th><th>Origen</th><th>Nicho</th></tr></thead>
                    <tbody id="tabla-body"></tbody>
                </table>
            </div>
        </section>

        <section id="galeria" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">GALER√çA</h2>
            <div id="galeria-cards" class="galeria"></div>
        </section>

        <section id="ranking" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">RANKING</h2>
            <div id="barChart"></div>
        </section>

        <section id="mapa" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">MAPA DE CHINA</h2>
            <div id="chinaMap"></div>
        </section>

        <section id="metodo" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">M√âTODO ETNO-ECOL√ìGICO</h2>
            <div class="metodo">
                <h3>Limitaciones metodol√≥gicas</h3>
                <div style="padding:12px;background:rgba(255,100,100,0.05);border-radius:6px;border-left:3px solid #ff6464;font-size:0.82rem;color:#aaa;line-height:1.6;margin-bottom:20px;">
                    <strong style="color:#ff6464">Variables no disponibles en Douyin:</strong><br>
                    ‚Ä¢ Fecha de creaci√≥n de cuenta (no p√∫blica)<br>
                    ‚Ä¢ Historial completo de publicaciones (contenido curado din√°micamente)<br>
                    ‚Ä¢ Distinci√≥n entre contenido original y re-subido<br><br>
                    <strong style="color:#00ffcc">Implicaci√≥n:</strong><br>
                    Las m√©tricas de engagement reflejan conexi√≥n acumulada, pero no pueden 
                    distinguir entre crecimiento reciente y trayectoria consolidada. 
                    Los hallazgos se enfocan en patrones tem√°ticos y engagement relativo, 
                    no en evoluci√≥n temporal.
                </div>
                <h3>Pregunta de investigaci√≥n</h3>
                <p style="color:#aaa;font-size:0.95rem;margin-bottom:20px;line-height:1.6;">
                    <strong>¬øQu√© tem√°ticas promueven las creadoras chinas con Belleza ‚â•3 y Destreza ‚â•3 en Douyin, y qu√© patrones de preferencia de audiencia revelan sus m√©tricas de engagement?</strong>
                </p>
                <h3>Criterios de selecci√≥n de la muestra</h3>
                <p style="color:#aaa;font-size:0.9rem;margin-bottom:15px;">
                    Este estudio emplea <strong>muestreo intencional cualitativo</strong>. 
                    Las creadoras fueron seleccionadas manualmente seg√∫n dos variables observables:
                </p>
                <ul style="color:#aaa;font-size:0.9rem;line-height:1.8;">
                    <li><strong>Belleza (Est√©tica visual + sugesti√≥n):</strong> Grooming/producci√≥n visual, estilizaci√≥n intencional, exposici√≥n corporal, presencia esc√©nica consciente (escala 0-5)</li>
                    <li><strong>Destreza (Habilidad performativa):</strong> Complejidad de movimiento, precisi√≥n t√©cnica, dificultad f√≠sica, dominio del medio (escala 0-5)</li>
                </ul>
                <p style="color:#aaa;font-size:0.9rem;line-height:1.6;margin-bottom:15px;">
                    <strong>Regla de inclusi√≥n:</strong> Belleza ‚â• 3 Y Destreza ‚â• 3 (escala 0-5).
                </p>
                <p style="color:#888;font-size:0.85rem;margin:15px 0;font-style:italic;">
                    <strong>Importante:</strong> La cantidad de seguidores y el tiempo de actividad NO fueron criterios de inclusi√≥n. 
                    El an√°lisis de creadoras con ‚â•1M seguidores es una capa anal√≠tica secundaria para observar patrones 
                    en creadoras de alto alcance, no la base del muestreo.
                </p>
                <h3>Enfoque</h3>
                <ul><li>Observaci√≥n participante en Douyin (2024-2026)</li><li>Selecci√≥n intencional de casos con Belleza+Destreza alta</li><li>An√°lisis cualitativo de contenido + m√©tricas cuantitativas complementarias</li></ul>
                <h3>M√©tricas clave</h3>
                <ul>
                    <li><strong>Ratio:</strong> Likes √∑ Seguidores (engagement relativo)</li>
                    <li><strong>Origen:</strong> Provincia/ciudad de la creadora</li>
                    <li><strong>Nicho:</strong> Categor√≠a principal de contenido</li>
                </ul>
                <h3>Visualizaci√≥n</h3>
                <ul><li>Mapa interactivo con ECharts</li><li>Ranking de engagement por creadora</li><li>Galer√≠a visual con filtros por nicho</li></ul>
            </div>
        </section>

        <!-- ‚úÖ NUEVA SECCI√ìN: AN√ÅLISIS TEMPORAL -->
        <section id="temporal" class="section">
            <h2 style="margin-bottom:20px;color:#00ffcc">AN√ÅLISIS TEMPORAL</h2>
            <p style="color:#888;margin-bottom:20px">Engagement y antig√ºedad verificada v√≠a Êó•ÊúüÁ≠õÈÄâ</p>
            
            <div class="stats" id="temporal-stats"></div>
            
            <div style="background:#1a1a1a;padding:20px;border-radius:10px;border:1px solid #333;margin-top:20px;">
                <h3 style="color:#00ffcc;margin-bottom:15px;">üìà Top Engagement Ratio</h3>
                <div id="top-ratio-list" style="display:grid;gap:8px;"></div>
            </div>
            
            <div style="background:#1a1a1a;padding:20px;border-radius:10px;border:1px solid #333;margin-top:20px;">
                <h3 style="color:#00ffcc;margin-bottom:15px;">üìÖ Distribuci√≥n por A√±o de Inicio</h3>
                <div id="year-distribution" style="display:grid;gap:10px;"></div>
            </div>
            
            <div style="padding:15px;background:rgba(0,255,204,0.05);border-radius:8px;border-left:3px solid #00ffcc;margin-top:20px;font-size:0.85rem;color:#aaa;line-height:1.6;">
                <strong style="color:#00ffcc">Hallazgo clave:</strong><br>
                Belleza ‚â•3 + Destreza ‚â•3 = Engagement 14-31+<br>
                Independiente de antig√ºedad (2018-2025)<br>
                <em style="color:#888">Datos temporales verificados cuando el acceso a Douyin lo permiti√≥</em>
            </div>
        </section>

        <footer>
            <p>Estudio Etno-Ecol√≥gico de Nichos en Douyin 2026</p>
            <p style="margin-top:10px">Juan Carlos Delgado ¬∑ Marzo 2026</p>
            <p id="footer-fichas" style="margin-top:10px;color:#666">0 creadoras</p>
        </footer>
    </div>

    <div id="modal" onclick="cerrarModal()">
        <span class="modal-close">&times;</span>
        <img id="modal-img" src="" alt="Vista ampliada">
    </div>

    <script src="fichas.js?v=2026032201"></script>
    <script>
        let cardsVisibles = 12;
        const cardsPorCarga = 12;

        function getVal(obj, key) {
            if (!obj) return '';
            const keys = [key, key + ' ', key.toLowerCase(), key.toLowerCase() + ' ', 
                         key.charAt(0).toUpperCase() + key.slice(1), 
                         key.charAt(0).toUpperCase() + key.slice(1) + ' '];
            for (let k of keys) {
                if (obj[k] !== undefined && obj[k] !== null) return obj[k];
            }
            return '';
        }

        function getNum(obj, key) {
            const val = getVal(obj, key);
            return typeof val === 'number' ? val : parseFloat(val) || 0;
        }

        function calcularTop3Tematicas() {
            const datos = window.fichas || [];
            if (!datos || datos.length === 0) return;
            const famosas = datos.filter(f => getNum(f, 'seguidores') >= 1);
            if (famosas.length === 0) {
                document.getElementById('top3-tematicas').innerHTML = '<p style="text-align:center;color:#888">Sin creadoras destacadas (‚â•1M seguidores)</p>';
                return;
            }
            const conteo = {};
            famosas.forEach(f => {
                const t = (getVal(f, 'tematica_principal') || 'otras').toLowerCase();
                if (!conteo[t]) conteo[t] = 0;
                conteo[t]++;
            });
            const total = famosas.length;
            const top3 = Object.entries(conteo)
                .map(([tematica, count]) => ({ tematica, count, porcentaje: Math.round((count / total) * 100) }))
                .sort((a, b) => b.porcentaje - a.porcentaje)
                .slice(0, 3);
            const medallas = ['1.', '2.', '3.'];
            let html = '';
            top3.forEach((item, i) => {
                const nombre = item.tematica.charAt(0).toUpperCase() + item.tematica.slice(1);
                html += `<div class="top3-item"><div class="medal">${medallas[i]}</div><div class="top3-info"><div class="top3-name">${nombre}</div><div class="top3-desc">${item.count} de ${total} creadoras</div></div><div class="percentage">${item.porcentaje}%</div></div>`;
            });
            document.getElementById('top3-tematicas').innerHTML = html;
        }

        function actualizarComposicionMuestra() {
            const datos = window.fichas || [];
            if (!datos || datos.length === 0) return;
            let mega = 0, macro = 0, midtier = 0, micro = 0;
            datos.forEach(f => {
                const seg = getNum(f, 'seguidores');
                if (seg >= 10) mega++;
                else if (seg >= 5) macro++;
                else if (seg >= 1) midtier++;
                else micro++;
            });
            const composicionDiv = document.getElementById('composicion-muestra');
            if (composicionDiv) {
                let texto = `‚Ä¢ ${midtier} Mid-tier (1-5M) + ${micro} Micro (<1M)`;
                if (macro > 0) texto += ` + ${macro} Macro (5-10M)`;
                if (mega > 0) texto += ` + ${mega} Mega (‚â•10M)`;
                texto += ` = ${datos.length} total<br>‚Ä¢ Todas seleccionadas por Belleza ‚â•3 + Destreza ‚â•3`;
                composicionDiv.innerHTML = texto;
            }
        }

        function calcularGustosChinos() {
            const datos = window.fichas || [];
            if (!datos || datos.length === 0) return;
            const conteo = {};
            datos.forEach(f => {
                const tematica = getVal(f, 'tematica_principal') || 'Otros';
                if (!conteo[tematica]) conteo[tematica] = 0;
                conteo[tematica]++;
            });
            const total = datos.length;
            const porcentajes = Object.entries(conteo)
                .map(([tematica, count]) => ({
                    tematica,
                    count,
                    porcentaje: ((count / total) * 100).toFixed(1)
                }))
                .sort((a, b) => b.porcentaje - a.porcentaje);
            const container = document.getElementById('gustos-chinos-container');
            if (container) {
                let html = '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:10px;">';
                porcentajes.forEach(item => {
                    const color = item.porcentaje >= 25 ? '#00ffcc' : item.porcentaje >= 15 ? '#ffaa00' : '#888';
                    html += `<div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:6px;text-align:center;border-left:3px solid ${color};">
                        <div style="font-size:1.5rem;font-weight:bold;color:${color}">${item.porcentaje}%</div>
                        <div style="font-size:0.8rem;color:#aaa;margin-top:5px">${item.tematica}</div>
                        <div style="font-size:0.7rem;color:#666;margin-top:3px">${item.count} de ${total}</div>
                    </div>`;
                });
                html += '</div>';
                html += `<p style="font-size:0.75rem;color:#666;margin-top:10px;text-align:center;">Actualizado autom√°ticamente ¬∑ ${total} creadoras</p>`;
                container.innerHTML = html;
            }
        }

        function actualizarPagina() {
            const datos = window.fichas || [];
            if (!datos || datos.length === 0) return;
            const porSeguidores = [...datos].sort((a, b) => getNum(b, 'seguidores') - getNum(a, 'seguidores'));
            document.getElementById('total-fichas').textContent = datos.length;
            document.getElementById('max-seguidores').textContent = getNum(porSeguidores[0], 'seguidores').toFixed(2) + 'M';
            document.getElementById('max-ratio').textContent = Math.max(...datos.map(f => getNum(f, 'ratio'))).toFixed(2);
            const regiones = new Set(datos.map(f => (getVal(f, 'provincia') || getVal(f, 'origen') || '').split(',')[0].trim()));
            document.getElementById('total-regiones').textContent = regiones.size;
            document.getElementById('footer-fichas').textContent = datos.length + ' creadoras ¬∑ 30,500+ comunidad';
            const tbody = document.getElementById('tabla-body');
            if (tbody) {
                tbody.innerHTML = '';
                porSeguidores.forEach(f => {
                    tbody.innerHTML += `<tr><td>${getVal(f, 'nombre')} (${getVal(f, 'pinyin')})</td><td>${getNum(f, 'seguidores').toFixed(3)}M</td><td>${getNum(f, 'like')}M</td><td>${getNum(f, 'ratio').toFixed(2)}</td><td>${getVal(f, 'origen')}</td><td>${getVal(f, 'nicho')}</td></tr>`;
                });
            }
            const galeria = document.getElementById('galeria-cards');
            if (galeria) {
                galeria.innerHTML = '';
                datos.slice(0, cardsVisibles).forEach(f => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.onclick = (e) => { e.stopPropagation(); abrirModal(getVal(f, 'archivo')); };
                    card.innerHTML = `<img src="https://raw.githubusercontent.com/dicarlophotoart-blip/estudio-douyin-2026/main/cards/${encodeURIComponent(getVal(f, 'archivo'))}" class="card-img" loading="lazy" onerror="this.style.display='none'">`;
                    galeria.appendChild(card);
                });
                if (cardsVisibles < datos.length) {
                    const btnMas = document.createElement('div');
                    btnMas.style.cssText = 'grid-column: 1/-1; text-align: center; margin: 30px 0;';
                    btnMas.innerHTML = `<button class="nav-item" onclick="cargarMasCards()" style="padding:12px 30px;font-size:16px;cursor:pointer;">Ver m√°s (${datos.length - cardsVisibles})</button>`;
                    galeria.appendChild(btnMas);
                }
            }
            calcularTop3Tematicas();
            actualizarComposicionMuestra();
            calcularGustosChinos();
        }

        function cargarMasCards() {
            cardsVisibles += cardsPorCarga;
            actualizarPagina();
            document.getElementById('galeria').scrollIntoView({ behavior: 'smooth' });
        }

        function generarMapa() {
            const mapDiv = document.getElementById('chinaMap');
            if (!mapDiv) return;
            let chart = echarts.getInstanceByDom(mapDiv);
            if (chart) echarts.dispose(chart);
            chart = echarts.init(mapDiv);
            const datos = window.fichas || [];
            const conCoord = datos.filter(f => {
                const x = getNum(f, 'coord_x') || getNum(f, 'Coord x');
                const y = getNum(f, 'coord_y') || getNum(f, 'Coord y');
                return x && y;
            });
            const grupos = {};
            conCoord.forEach(f => {
                const x = getNum(f, 'coord_x') || getNum(f, 'Coord x');
                const y = getNum(f, 'coord_y') || getNum(f, 'Coord y');
                const key = x + ',' + y;
                if (!grupos[key]) grupos[key] = { coord: [x, y], creadoras: [], total: 0 };
                grupos[key].creadoras.push(f);
                grupos[key].total += getNum(f, 'seguidores');
            });
            const puntosData = Object.values(grupos).map(g => ({
                name: g.creadoras.length > 1 ? g.creadoras.length + ' creadoras' : getVal(g.creadoras[0], 'nombre'),
                value: [...g.coord, g.creadoras.length],
                cantidad: g.creadoras.length,
                creadoras: g.creadoras.map(c => ({ nombre: getVal(c, 'nombre'), pinyin: getVal(c, 'pinyin'), origen: getVal(c, 'origen'), nicho: getVal(c, 'nicho'), seguidores: getNum(c, 'seguidores'), ratio: getNum(c, 'ratio') })),
                totalSeguidores: g.total
            }));
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Distribuci√≥n de ' + conCoord.length + ' creadoras', left: 'center', textStyle: { color: '#00ffcc', fontSize: 16 } },
                tooltip: { 
                    trigger: 'item', 
                    formatter: (p) => { 
                        const d = p.data; 
                        if (!d || !d.creadoras) return ''; 
                        let h = '<b>' + d.cantidad + ' creadora' + (d.cantidad > 1 ? 's' : '') + '</b><br/>Total: ' + d.totalSeguidores.toFixed(3) + 'M<br/><br/>'; 
                        d.creadoras.forEach((c, i) => { 
                            h += (i+1) + '. <b>' + c.nombre + '</b> (' + c.pinyin + ')<br/>   ' + c.origen + '<br/>   ' + c.nicho + '<br/>   ' + c.seguidores.toFixed(3) + 'M ¬∑ ' + c.ratio.toFixed(2) + '<br/><br/>'; 
                        }); 
                        return h.slice(0, -4); 
                    } 
                },
                geo: { 
                    map: 'china', roam: true, zoom: 1.2, 
                    label: { show: true, color: '#fff', fontSize: 9 }, 
                    itemStyle: { areaColor: '#1a1a1a', borderColor: '#00ffcc', borderWidth: 1 }, 
                    emphasis: { itemStyle: { areaColor: '#2a2a2a' } } 
                },
                series: [{ 
                    name: 'Puntos', type: 'scatter', coordinateSystem: 'geo', 
                    data: puntosData,
                    symbol: 'circle', symbolSize: v => Math.max(12, Math.min(60, v[2]*10 + Math.sqrt(v[2])*5)), 
                    label: { show: true, formatter: p => p.data.cantidad > 1 ? p.data.cantidad : '', position: 'inside', color: '#000', fontSize: 12, fontWeight: 'bold' }, 
                    itemStyle: { color: p => p.data.cantidad > 1 ? '#ffaa00' : '#00ffcc', borderColor: '#fff', borderWidth: 2, shadowBlur: 10 }, 
                    emphasis: { itemStyle: { color: p => p.data.cantidad > 1 ? '#ffcc00' : '#00ffff', borderWidth: 4 } } 
                }]
            };
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        function generarRanking() {
            const chartDiv = document.getElementById('barChart');
            if (!chartDiv) return;
            let chart = echarts.getInstanceByDom(chartDiv);
            if (chart) echarts.dispose(chart);
            chart = echarts.init(chartDiv);
            const datos = window.fichas || [];
            const top10 = [...datos].sort((a, b) => getNum(b, 'ratio') - getNum(a, 'ratio')).slice(0, 10);
            const nombres = top10.map(f => getVal(f, 'nombre') + '\n' + getVal(f, 'pinyin'));
            const likesData = top10.map(f => getNum(f, 'like'));
            const seguidoresData = top10.map(f => getNum(f, 'seguidores'));
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Top 10: Likes vs Seguidores', subtext: 'Cyan = Likes | Naranja = Seguidores', left: 'center', textStyle: { color: '#00ffcc', fontSize: 16 }, subtextStyle: { color: '#888', fontSize: 11 } },
                tooltip: { 
                    trigger: 'axis', axisPointer: { type: 'shadow' }, 
                    formatter: p => { 
                        const f = top10[p[0].dataIndex]; 
                        return '<b>' + getVal(f, 'nombre') + '</b> (' + getVal(f, 'pinyin') + ')<br/>' + getVal(f, 'origen') + '<br/>Likes: <b style="color:#00ffcc">' + getNum(f, 'like') + 'M</b><br/>Seguidores: <b style="color:#ffaa00">' + getNum(f, 'seguidores').toFixed(2) + 'M</b><br/>Ratio: <b style="color:#00ffcc">' + getNum(f, 'ratio').toFixed(2) + '</b>'; 
                    } 
                },
                legend: { data: ['Likes (M)', 'Seguidores (M)'], textStyle: { color: '#fff' }, top: 40 },
                grid: { left: '3%', right: '4%', bottom: '3%', top: '15%', containLabel: true },
                xAxis: { type: 'value', name: 'Millones', axisLine: { lineStyle: { color: '#00ffcc' } }, axisLabel: { color: '#888' }, splitLine: { lineStyle: { color: '#333', type: 'dashed' } } },
                yAxis: { type: 'category', data: nombres, axisLabel: { color: '#fff', fontSize: 11, margin: 15 } },
                series: [
                    { name: 'Likes (M)', type: 'bar', data: likesData, itemStyle: { color: '#00ffcc', borderRadius: [0, 3, 3, 0] }, label: { show: true, position: 'right', color: '#00ffcc', fontSize: 10, formatter: p => p.value + 'M' } },
                    { name: 'Seguidores (M)', type: 'bar', data: seguidoresData, itemStyle: { color: '#ffaa00', borderRadius: [0, 3, 3, 0] }, label: { show: true, position: 'right', color: '#ffaa00', fontSize: 10, formatter: p => p.value.toFixed(2) + 'M' } }
                ]
            };
            chart.setOption(option);
            setTimeout(() => chart.resize(), 100);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            if (sectionId === 'mapa') setTimeout(() => generarMapa(), 200);
            if (sectionId === 'ranking') setTimeout(() => generarRanking(), 200);
            if (sectionId === 'galeria') setTimeout(() => actualizarPagina(), 200);
            if (sectionId === 'temporal') setTimeout(() => generarSeccionTemporal(), 200);
        }

        function abrirModal(archivo) {
            const img = document.getElementById('modal-img');
            const modal = document.getElementById('modal');
            if (img && modal) {
                img.src = 'https://raw.githubusercontent.com/dicarlophotoart-blip/estudio-douyin-2026/main/cards/' + encodeURIComponent(archivo);
                modal.style.display = 'block';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function cerrarModal() {
            const modal = document.getElementById('modal');
            if (modal) { 
                modal.style.display = 'none'; 
                modal.classList.remove('active');
                document.body.style.overflow = 'auto'; 
            }
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') cerrarModal(); });
        document.getElementById('modal')?.addEventListener('click', function(e) { if (e.target === this) cerrarModal(); });

        // ============================================
        // DATOS TEMPORALES - 23 CREADORAS
        // ============================================
        const creadorasTemporal = [
          { nombre: "Angier ÂÆâÁê™", pinyin: "Angier", seguidores: 2.92, likes: 86.07, ratio: 29.56, origen: "Zhejiang", nicho: "Danza", a√±o: 2022, meses: 48, likesMes: 1.79, clasificacion: "confirmada" },
          { nombre: "Â¶ÆËÄÅÂ∏à", pinyin: "Ni Lao Shi", seguidores: 3.49, likes: 110, ratio: 31.56, origen: "Fujian", nicho: "Performance", a√±o: 2022, meses: 48, likesMes: 2.29, clasificacion: "confirmada" },
          { nombre: "Â§ß‰Ω¨ÁîúGiovanna", pinyin: "Da Lao Tian", seguidores: 4.98, likes: 130, ratio: 26.12, origen: "Sichuan", nicho: "Lifestyle", a√±o: 2018, meses: 96, likesMes: 1.35, clasificacion: "confirmada" },
          { nombre: "ÈöôÊôìÊöÆÔºàÁêµÁê∂Â∑•‰ΩúÂÆ§Ôºâ", pinyin: "Xi Xiao Mu", seguidores: 0.05, likes: 0.714, ratio: 14.28, origen: "Inner Mongolia", nicho: "Pipa", a√±o: 2024, meses: 24, likesMes: 0.03, clasificacion: "confirmada" },
          { nombre: "Áå´Âß®", pinyin: "Mao Yi", seguidores: 2.96, likes: 75.94, ratio: 25.66, origen: "Sichuan", nicho: "Performance", a√±o: 2022, meses: 48, likesMes: 1.58, clasificacion: "confirmada" },
          { nombre: "Âç¢Êüî‰ºä", pinyin: "Lu Rou Yi", seguidores: 2.62, likes: 49.48, ratio: 18.89, origen: "Zhejiang", nicho: "Guzheng", a√±o: 2021, meses: 60, likesMes: 0.825, clasificacion: "confirmada" },
          { nombre: "Âàò‰π¶Âê´Rose.", pinyin: "Liu Shu Han", seguidores: 0.999, likes: 17.03, ratio: 17.05, origen: "Liaoning", nicho: "Opera", a√±o: 2018, meses: 96, likesMes: 0.177, clasificacion: "confirmada" },
          { nombre: "ÁßãÊúàÂáâ", pinyin: "Qiu Yue Liang", seguidores: 0.944, likes: 15.33, ratio: 16.24, origen: "Sichuan", nicho: "Lifestyle", a√±o: 2023, meses: 36, likesMes: 0.426, clasificacion: "confirmada" },
          { nombre: "ÊΩáÊ¥íÂ∞èÊü¥", pinyin: "Xiao Sa Xiao Chai", seguidores: 0.468, likes: 6.60, ratio: 14.10, origen: "Hunan", nicho: "Gaming", a√±o: 2023, meses: 36, likesMes: 0.183, clasificacion: "confirmada" },
          { nombre: "Â∞èÁôΩÁãÆÊù®Âßê", pinyin: "Xiao Bai Shi Yang Jie", seguidores: 2.24, likes: 22.70, ratio: 10.13, origen: "Shaanxi", nicho: "Live", a√±o: 2022, meses: 48, likesMes: 0.473, clasificacion: "fronteriza" },
          { nombre: "ÊãøÈìÅÁ¨õÂ≠ê", pinyin: "Na Tie Dizi", seguidores: 2.27, likes: 26.16, ratio: 11.52, origen: "Liaoning", nicho: "Fitness", a√±o: 2021, meses: 60, likesMes: 0.436, clasificacion: "fronteriza" },
          { nombre: "ÁΩóÊñØÈú≤Rose", pinyin: "Luo Si Lu", seguidores: 1.56, likes: 12.30, ratio: 7.88, origen: "Sichuan", nicho: "Danza Atletica", a√±o: 2020, meses: 72, likesMes: 0.171, clasificacion: "fronteriza" },
          { nombre: "Â∞èÈπ§owo", pinyin: "Xiao He", seguidores: 1.56, likes: 20.66, ratio: 13.24, origen: "Zhejiang", nicho: "Lifestyle", a√±o: 2022, meses: 48, likesMes: 0.430, clasificacion: "fronteriza" },
          { nombre: "ÂàòËëïÁæΩ", pinyin: "Liu Han Yu", seguidores: 0.232, likes: 1.49, ratio: 6.44, origen: "Malasia", nicho: "Murales", a√±o: 2023, meses: 36, likesMes: 0.041, clasificacion: "fronteriza" },
          { nombre: "Â∞è‰∏É„ÄÇ", pinyin: "Xiao Qi", seguidores: 0.998, likes: 5.69, ratio: 5.70, origen: "Sichuan", nicho: "Artesania", a√±o: 2023, meses: 36, likesMes: 0.158, clasificacion: "contraste" },
          { nombre: "ÁºòÂ¶ôÂ¶ô", pinyin: "Yuan Miao Miao", seguidores: 0.004, likes: 0.032, ratio: 8.93, origen: "Anhui", nicho: "Patrimonio", a√±o: 2025, meses: 12, likesMes: 0.003, clasificacion: "fronteriza" },
          { nombre: "ÊûóËãí‚òÄÔ∏è ‚Åπ¬≤‚Åµ‚Å∞", pinyin: "Lin Ran", seguidores: 0.064, likes: 0.251, ratio: 3.92, origen: "Jiangsu", nicho: "Lifestyle", a√±o: 2023, meses: 36, likesMes: 0.007, clasificacion: "contraste" },
          { nombre: "Mimi", pinyin: "Mimi", seguidores: 0.16, likes: 0.714, ratio: 4.35, origen: "?", nicho: "Lifestyle", a√±o: 2022, meses: 48, likesMes: 0.015, clasificacion: "contraste" },
          { nombre: "178ÁöÑÂàòÂ§™Èò≥", pinyin: "Liu Tai Yang", seguidores: 3.29, likes: 19.76, ratio: 6.01, origen: "Inner Mongolia", nicho: "Fitness", a√±o: 2018, meses: 96, likesMes: 0.206, clasificacion: "fronteriza" },
          { nombre: "È£ûÂ§©Â∞èÈ∫ªËä±", pinyin: "Fei Tian Xiao Ma Hua", seguidores: 3.20, likes: 39.03, ratio: 12.20, origen: "Liaoning", nicho: "Wushu", a√±o: 2022, meses: 48, likesMes: 0.813, clasificacion: "fronteriza" },
          { nombre: "ÈÉ≠ÂñÜÂñÜ", pinyin: "Guo Zhe Zhe", seguidores: 3.10, likes: 28.86, ratio: 9.31, origen: "Hubei", nicho: "Guofeng", a√±o: 2020, meses: 72, likesMes: 0.401, clasificacion: "fronteriza" },
          { nombre: "Ëé∑Ëé∑Á≥ñÁúãÁÇπ", pinyin: "Huo Huo Tang", seguidores: 0.008, likes: 0.047, ratio: 5.66, origen: "?", nicho: "Repost", a√±o: 2024, meses: 24, likesMes: 0.002, clasificacion: "contraste" },
          { nombre: "Á∫∏È±º", pinyin: "Zhi Yu", seguidores: 1.05, likes: 13.93, ratio: 13.26, origen: "Zhejiang", nicho: "Viajes", a√±o: 2022, meses: 48, likesMes: 0.290, clasificacion: "fronteriza" }
        ];

        function calcularEstadisticasTemporales() {
          const total = creadorasTemporal.length;
          const confirmadas = creadorasTemporal.filter(c => c.clasificacion === "confirmada").length;
          const fronterizas = creadorasTemporal.filter(c => c.clasificacion === "fronteriza").length;
          const contraste = creadorasTemporal.filter(c => c.clasificacion === "contraste").length;
          const porAno = {};
          creadorasTemporal.forEach(c => {
            if (!porAno[c.a√±o]) porAno[c.a√±o] = { count: 0, totalRatio: 0, creators: [] };
            porAno[c.a√±o].count++;
            porAno[c.a√±o].totalRatio += c.ratio;
            porAno[c.a√±o].creators.push(c.nombre);
          });
          Object.keys(porAno).forEach(a√±o => {
            porAno[a√±o].avgRatio = (porAno[a√±o].totalRatio / porAno[a√±o].count).toFixed(2);
          });
          const topRatio = [...creadorasTemporal].sort((a, b) => b.ratio - a.ratio).slice(0, 10);
          const avgRatio = (creadorasTemporal.reduce((sum, c) => sum + c.ratio, 0) / total).toFixed(2);
          const avgMeses = Math.round(creadorasTemporal.reduce((sum, c) => sum + c.meses, 0) / total);
          return { total, confirmadas, fronterizas, contraste, pctConfirmadas: ((confirmadas/total)*100).toFixed(1), porAno, topRatio, avgRatio, avgMeses };
        }

        function generarSeccionTemporal() {
          const stats = calcularEstadisticasTemporales();
          const statsDiv = document.getElementById('temporal-stats');
          if (statsDiv) {
            statsDiv.innerHTML = `
              <div class="stat-card"><div class="number" style="color:#4ade80">${stats.confirmadas} (${stats.pctConfirmadas}%)</div><div class="label">Confirman (14-31+)</div></div>
              <div class="stat-card"><div class="number" style="color:#fbbf24">${stats.fronterizas}</div><div class="label">Fronterizas (6-13.9)</div></div>
              <div class="stat-card"><div class="number" style="color:#f87171">${stats.contraste}</div><div class="label">Contraste (&lt;6)</div></div>
              <div class="stat-card"><div class="number">${stats.avgRatio}</div><div class="label">Ratio Promedio</div></div>
            `;
          }
          const topList = document.getElementById('top-ratio-list');
          if (topList) {
            topList.innerHTML = stats.topRatio.map((c, i) => `
              <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:6px;">
                <div><strong style="color:#fff">${i+1}. ${c.nombre}</strong><span style="color:#888;font-size:0.8rem;margin-left:8px">(${c.a√±o})</span></div>
                <div style="font-weight:bold;color:#00ffcc">${c.ratio}</div>
              </div>
            `).join('');
          }
          const yearDiv = document.getElementById('year-distribution');
          if (yearDiv) {
            yearDiv.innerHTML = Object.entries(stats.porAno).sort((a,b) => a[0] - b[0]).map(([a√±o, data]) => `
              <div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:6px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <strong style="color:#00ffcc;font-size:1.1rem">${a√±o}</strong>
                  <div style="text-align:right;">
                    <div style="font-weight:bold;color:#fff">${data.count} creadoras</div>
                    <div style="font-size:0.8rem;color:#aaa">Ratio prom: ${data.avgRatio}</div>
                  </div>
                </div>
                <div style="font-size:0.8rem;color:#888;margin-top:5px;opacity:0.9">${data.creators.slice(0,3).join(', ')}${data.creators.length > 3 ? '...' : ''}</div>
              </div>
            `).join('');
          }
        }

        function iniciarApp() {
            if (typeof window.fichas === 'undefined' || !window.fichas || window.fichas.length === 0) {
                console.log('Esperando datos...');
                setTimeout(iniciarApp, 100);
                return;
            }
            console.log('Datos cargados:', window.fichas.length, 'creadoras');
            actualizarPagina();
            if (typeof echarts !== 'undefined') {
                fetch('china.json')
                    .then(response => { if (!response.ok) throw new Error('HTTP ' + response.status); return response.json(); })
                    .then(chinaJson => {
                        echarts.registerMap('china', chinaJson);
                        console.log('‚úÖ Mapa registrado - Features:', chinaJson.features?.length);
                    })
                    .catch(error => {
                        console.error('‚ùå Error cargando china.json:', error);
                        document.getElementById('chinaMap').innerHTML = '<div style="text-align:center;padding:80px;color:#ffaa00;"><h3>Mapa no disponible</h3><p>' + error.message + '</p></div>';
                    });
            }
        }

        document.addEventListener('DOMContentLoaded', iniciarApp);
    </script>
</body>
</html>
